/*
     YUI 3.15.0 (build 834026e)
     Copyright 2014 Yahoo! Inc. All rights reserved.
     Licensed under the BSD License.
     http://yuilibrary.com/license/
     */
YUI.add('dd-ddm-drop',function(Y,NAME){Y.mix(Y.DD.DDM,{_noShim:false,_activeShims:[],_hasActiveShim:function(){if(this._noShim){return true;}
return this._activeShims.length;},_addActiveShim:function(d){this._activeShims.push(d);},_removeActiveShim:function(d){var s=[];Y.Array.each(this._activeShims,function(v){if(v._yuid!==d._yuid){s.push(v);}});this._activeShims=s;},syncActiveShims:function(force){Y.later(0,this,function(force){var drops=((force)?this.targets:this._lookup());Y.Array.each(drops,function(v){v.sizeShim.call(v);},this);},force);},mode:0,POINT:0,INTERSECT:1,STRICT:2,useHash:true,activeDrop:null,validDrops:[],otherDrops:{},targets:[],_addValid:function(drop){this.validDrops.push(drop);return this;},_removeValid:function(drop){var drops=[];Y.Array.each(this.validDrops,function(v){if(v!==drop){drops.push(v);}});this.validDrops=drops;return this;},isOverTarget:function(drop){if(this.activeDrag&&drop){var xy=this.activeDrag.mouseXY,r,dMode=this.activeDrag.get('dragMode'),aRegion,node=drop.shim;if(xy&&this.activeDrag){aRegion=this.activeDrag.region;if(dMode===this.STRICT){return this.activeDrag.get('dragNode').inRegion(drop.region,true,aRegion);}
if(drop&&drop.shim){if((dMode===this.INTERSECT)&&this._noShim){r=aRegion||this.activeDrag.get('node');return drop.get('node').intersect(r,drop.region).inRegion;}
if(this._noShim){node=drop.get('node');}
return node.intersect({top:xy[1],bottom:xy[1],left:xy[0],right:xy[0]},drop.region).inRegion;}}}
return false;},clearCache:function(){this.validDrops=[];this.otherDrops={};this._activeShims=[];},_activateTargets:function(){this._noShim=true;this.clearCache();Y.Array.each(this.targets,function(v){v._activateShim([]);if(v.get('noShim')===true){this._noShim=false;}},this);this._handleTargetOver();},getBestMatch:function(drops,all){var biggest=null,area=0,out;Y.Object.each(drops,function(v){var inter=this.activeDrag.get('dragNode').intersect(v.get('node'));v.region.area=inter.area;if(inter.inRegion){if(inter.area>area){area=inter.area;biggest=v;}}},this);if(all){out=[];Y.Object.each(drops,function(v){if(v!==biggest){out.push(v);}},this);return[biggest,out];}
return biggest;},_deactivateTargets:function(){var other=[],tmp,activeDrag=this.activeDrag,activeDrop=this.activeDrop;if(activeDrag&&activeDrop&&this.otherDrops[activeDrop]){if(!activeDrag.get('dragMode')){other=this.otherDrops;delete other[activeDrop];}else{tmp=this.getBestMatch(this.otherDrops,true);activeDrop=tmp[0];other=tmp[1];}
activeDrag.get('node').removeClass(this.CSS_PREFIX+'-drag-over');if(activeDrop){activeDrop.fire('drop:hit',{drag:activeDrag,drop:activeDrop,others:other});activeDrag.fire('drag:drophit',{drag:activeDrag,drop:activeDrop,others:other});}}else if(activeDrag&&activeDrag.get('dragging')){activeDrag.get('node').removeClass(this.CSS_PREFIX+'-drag-over');activeDrag.fire('drag:dropmiss',{pageX:activeDrag.lastXY[0],pageY:activeDrag.lastXY[1]});}
this.activeDrop=null;Y.Array.each(this.targets,function(v){v._deactivateShim([]);},this);},_dropMove:function(){if(this._hasActiveShim()){this._handleTargetOver();}else{Y.Object.each(this.otherDrops,function(v){v._handleOut.apply(v,[]);});}},_lookup:function(){if(!this.useHash||this._noShim){return this.validDrops;}
var drops=[];Y.Array.each(this.validDrops,function(v){if(v.shim&&v.shim.inViewportRegion(false,v.region)){drops.push(v);}});return drops;},_handleTargetOver:function(){var drops=this._lookup();Y.Array.each(drops,function(v){v._handleTargetOver.call(v);},this);},_regTarget:function(t){this.targets.push(t);},_unregTarget:function(drop){var targets=[],vdrops;Y.Array.each(this.targets,function(v){if(v!==drop){targets.push(v);}},this);this.targets=targets;vdrops=[];Y.Array.each(this.validDrops,function(v){if(v!==drop){vdrops.push(v);}});this.validDrops=vdrops;},getDrop:function(node){var drop=false,n=Y.one(node);if(n instanceof Y.Node){Y.Array.each(this.targets,function(v){if(n.compareTo(v.get('node'))){drop=v;}});}
return drop;}},true);},'3.15.0',{"requires":["dd-ddm"]});